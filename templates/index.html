{% extends 'base.html' %}
{% load static %}

{% block title %}Home - Krishi Sakhi{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/index.css' %}">
<style>
    /* 1. HERO LAYOUT */
    .content-wrapper {
        max-width: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
    }

    .hero {
        min-height: 100vh;
        padding-top: 70px; /* Space for navbar */
        background-size: cover;
        background-position: center;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        position: relative;
    }
    
    .hero::before {
        content: "";
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.4);
        z-index: 1;
    }

    .hero-text {
        position: relative;
        z-index: 2;
        color: white;
    }

    /* 2. MOBILE BUTTONS */
    @media (max-width: 768px) {
        .hero-text { width: 90%; padding: 1.5rem; }
        .hero-text h1 { font-size: 2rem; }
        .hero-buttons {
            display: flex; flex-direction: column; gap: 15px;
            align-items: center; width: 100%;
        }
        .hero-buttons .btn { width: 100%; margin: 0 !important; }
    }

    /* 3. ONBOARDING POPUP STYLES */
    .onboarding-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 3000; display: none;
        align-items: center; justify-content: center;
        backdrop-filter: blur(5px);
    }
    .onboarding-card {
        background: white; width: 85%; max-width: 350px;
        border-radius: 20px; padding: 30px 20px;
        text-align: center; position: relative;
        animation: slideUp 0.5s ease-out;
    }
    .ob-icon { font-size: 5rem; margin-bottom: 20px; display: block; animation: float 3s infinite; }
    .ob-title { font-size: 1.5rem; color: #2c5e2e; margin-bottom: 10px; font-weight: 800; }
    .ob-desc { font-size: 1.1rem; color: #555; margin-bottom: 25px; line-height: 1.4; }
    .ob-dots { display: flex; justify-content: center; gap: 8px; margin-bottom: 25px; }
    .dot { width: 12px; height: 12px; background: #ddd; border-radius: 50%; transition: all 0.3s; }
    .dot.active { background: #4CAF50; transform: scale(1.3); }

    .ob-btn {
        background: #4CAF50; color: white; border: none;
        padding: 15px 40px; border-radius: 30px;
        font-size: 1.1rem; font-weight: bold; cursor: pointer; width: 100%;
    }
    .ob-skip { margin-top: 15px; font-size: 0.9rem; color: #888; cursor: pointer; text-decoration: underline; display: inline-block; }

    @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
</style>
{% endblock %}

{% block content %}
  <section class="hero">
    <div class="hero-text">
      {% if user.is_authenticated %}
        <h1 id="greeting">{{ timeGreeting|default:"Namaste" }}, {{ user.username }}! ЁЯМ╛</h1>
        <p>What would you like to do today?</p>
        
        <div class="hero-buttons">
            <a href="{% url 'analyze_field_dashboard' %}" class="btn">Analyze Field</a>
            <a href="{% url 'crop_prices' %}" class="btn" style="background: #ffc107; color: #333; margin-left: 10px;">Check Prices</a>
        </div>
        
        <div style="margin-top: 30px;">
            <a href="#" onclick="startOnboarding(); return false;" style="color: rgba(255,255,255,0.9); text-decoration: none; font-size: 1rem; border-bottom: 1px dotted white; padding-bottom: 2px;">
                тД╣я╕П How to use this app?
            </a>
        </div>
      {% else %}
        <h1>Welcome to Krishi Sakhi</h1>
        <p>Your smart farming assistant using AI ЁЯМ▒</p>
        <a href="{% url 'login' %}" class="btn">Login to Start</a>
      {% endif %}
    </div>
  </section>

  <footer style="text-align: center; padding: 1rem; background-color: #006400; color: #fff; position: relative; z-index: 2;">
    <p>┬й 2025 Krishi Sakhi | By MNV Nexus ЁЯМ╛</p>
  </footer>

  <div class="onboarding-overlay" id="onboardingModal">
      <div class="onboarding-card">
          <span class="ob-icon" id="obIcon">ЁЯУ╕</span>
          <div class="ob-title" id="obTitle">Identify Diseases</div>
          <div class="ob-desc" id="obDesc">Take a photo...</div>
          <div class="ob-dots">
              <span class="dot active" id="dot0"></span>
              <span class="dot" id="dot1"></span>
              <span class="dot" id="dot2"></span>
          </div>
          <button class="ob-btn" onclick="nextSlide()" id="obBtn">Next</button>
          <div class="ob-skip" onclick="closeOnboarding()">Skip Tutorial</div>
      </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
    const allTranslations = {
        'en': [
            { icon: "ЁЯУ╕", title: "1. Scan Your Crop", desc: "Click <b>'Analyze Field'</b>. Take a photo of your plant to detect diseases and get treatment." },
            { icon: "ЁЯЧгя╕П", title: "2. Talk to Sakhi", desc: "Click the <b>'Chat'</b> button below. Press the Mic ЁЯОд and ask questions in your language!" },
            { icon: "ЁЯТ░", title: "3. Get Money", desc: "Click <b>'Schemes'</b> to find government money and <b>'Market Prices'</b> for the best rates." }
        ],
        'hi': [
            { icon: "ЁЯУ╕", title: "1. рдлрд╕рд▓ рд╕реНрдХреИрди рдХрд░реЗрдВ", desc: "<b>'Analyze Field'</b> рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ. рдЕрдкрдиреА рдлрд╕рд▓ рдХреА рдлреЛрдЯреЛ рд▓реЗрдВ рдФрд░ рдмреАрдорд╛рд░реА рдХрд╛ рдЗрд▓рд╛рдЬ рдкрд╛рдПрдВ." },
            { icon: "ЁЯЧгя╕П", title: "2. рд╕рдЦреА рд╕реЗ рдмрд╛рдд рдХрд░реЗрдВ", desc: "рдиреАрдЪреЗ <b>'Chat'</b> рдмрдЯрди рджрдмрд╛рдПрдВ. рдорд╛рдЗрдХ ЁЯОд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЕрдкрдиреА рднрд╛рд╖рд╛ рдореЗрдВ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВ!" },
            { icon: "ЁЯТ░", title: "3. рдореБрдирд╛рдлрд╛ рдХрдорд╛рдПрдВ", desc: "рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП <b>'Schemes'</b> рджреЗрдЦреЗрдВ рдФрд░ рд╕рд╣реА рджрд╛рдо рдХреЗ рд▓рд┐рдП <b>'Market Prices'</b> рдЪреЗрдХ рдХрд░реЗрдВ." }
        ],
        'ta': [
            { icon: "ЁЯУ╕", title: "1. рокропро┐ро░рпИ ро╕рпНроХрпЗройрпН роЪрпЖропрпНропро╡рпБроорпН", desc: "<b>'Analyze Field'</b> роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН. роирпЛропрпИроХрпН роХрогрпНроЯро▒ро┐роп роЙроЩрпНроХро│рпН рокропро┐ро░ро┐ройрпН рокрпБроХрпИрокрпНрокроЯродрпНродрпИ роОроЯрпБроХрпНроХро╡рпБроорпН." },
            { icon: "ЁЯЧгя╕П", title: "2. роЪроХро┐ропрпБроЯройрпН рокрпЗроЪрпБроЩрпНроХро│рпН", desc: "роХрпАро┤рпЗ роЙро│рпНро│ <b>'Chat'</b> рокроЯрпНроЯройрпИ роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН. роорпИроХрпН ЁЯОд роорпВро▓роорпН роЙроЩрпНроХро│рпН роорпКро┤ро┐ропро┐ро▓рпН роХрпЗро│рпНро╡ро┐ роХрпЗро│рпБроЩрпНроХро│рпН!" },
            { icon: "ЁЯТ░", title: "3. роЕродро┐роХ ро▓ро╛рокроорпН", desc: "роЕро░роЪрпБ рооро╛ройро┐ропроЩрпНроХро│рпБроХрпНроХрпБ <b>'Schemes'</b> рооро▒рпНро▒рпБроорпН роЪроирпНродрпИ ро╡ро┐ро▓рпИроХрпНроХрпБ <b>'Market Prices'</b> рокро╛ро░рпНроХрпНроХро╡рпБроорпН." }
        ],
        'te': [
            { icon: "ЁЯУ╕", title: "1. р░кр░Вр░Яр░ир▒Б р░╕р▒Нр░Хр░╛р░ир▒Н р░Ър▒Зр░пр░Вр░бр░┐", desc: "<b>'Analyze Field'</b> р░Хр▒Нр░▓р░┐р░Хр▒Н р░Ър▒Зр░пр░Вр░бр░┐. р░др▒Жр░Чр▒Бр░│р▒Нр░│р░ир▒Б р░Чр▒Бр░░р▒Нр░др░┐р░Вр░Ър░бр░╛р░ир░┐р░Хр░┐ р░ор▒А р░кр░Вр░Я р░лр▒Лр░Яр▒Л р░др▒Ар░пр░Вр░бр░┐." },
            { icon: "ЁЯЧгя╕П", title: "2. р░╕р░Цр░┐р░др▒Л р░ор░╛р░Яр▒Нр░▓р░╛р░бр░Вр░бр░┐", desc: "р░Хр░┐р░Вр░ж р░Йр░ир▒Нр░и <b>'Chat'</b> р░мр░Яр░ир▒Н р░ир▒Кр░Хр▒Нр░Хр░Вр░бр░┐. р░ор▒Ир░Хр▒Н ЁЯОд р░жр▒Нр░╡р░╛р░░р░╛ р░ор▒А р░нр░╛р░╖р░▓р▒Л р░кр▒Нр░░р░╢р▒Нр░ир░▓р▒Б р░Ер░бр░Чр░Вр░бр░┐!" },
            { icon: "ЁЯТ░", title: "3. р░▓р░╛р░нр░╛р░▓р░ир▒Б р░кр▒Кр░Вр░жр░Вр░бр░┐", desc: "р░кр▒Нр░░р░нр▒Бр░др▒Нр░╡ р░кр░ер░Хр░╛р░▓ р░Хр▒Лр░╕р░В <b>'Schemes'</b> р░ор░░р░┐р░пр▒Б р░ор░╛р░░р▒Нр░Хр▒Жр░Яр▒Н р░зр░░р░▓ р░Хр▒Лр░╕р░В <b>'Market Prices'</b> р░Ър▒Вр░бр░Вр░бр░┐." }
        ],
        'kn': [
            { icon: "ЁЯУ╕", title: "1. р▓мр│Жр▓│р│Ж р▓╕р│Нр▓Хр│Нр▓пр▓╛р▓ир│Н р▓ор▓╛р▓бр▓┐", desc: "<b>'Analyze Field'</b> р▓Хр│Нр▓▓р▓┐р▓Хр│Н р▓ор▓╛р▓бр▓┐. р▓░р│Лр▓Ч р▓кр▓др│Нр▓др│Жр▓╣р▓Ър│Нр▓Ър▓▓р│Б р▓ир▓┐р▓ор│Нр▓о р▓мр│Жр▓│р│Жр▓п р▓лр│Лр▓Яр│Л р▓др│Жр▓Чр│Жр▓пр▓┐р▓░р▓┐." },
            { icon: "ЁЯЧгя╕П", title: "2. р▓╕р▓Цр▓┐ р▓Ьр│Кр▓др│Ж р▓ор▓╛р▓др▓ир▓╛р▓бр▓┐", desc: "р▓Хр│Жр▓│р▓Чр▓┐р▓и <b>'Chat'</b> р▓мр▓Яр▓ир│Н р▓Тр▓др│Нр▓др▓┐р▓░р▓┐. р▓ор│Ир▓Хр│Н ЁЯОд р▓мр▓│р▓╕р▓┐ р▓ир▓┐р▓ор│Нр▓о р▓нр▓╛р▓╖р│Жр▓пр▓▓р│Нр▓▓р▓┐ р▓кр│Нр▓░р▓╢р│Нр▓ир│Ж р▓Хр│Зр▓│р▓┐!" },
            { icon: "ЁЯТ░", title: "3. р▓▓р▓╛р▓н р▓кр▓бр│Жр▓пр▓┐р▓░р▓┐", desc: "р▓╕р▓░р│Нр▓Хр▓╛р▓░р▓┐ р▓пр│Лр▓Ьр▓ир│Жр▓Чр▓│р▓┐р▓Чр│Ж <b>'Schemes'</b> р▓ор▓др│Нр▓др│Б р▓ор▓╛р▓░р│Бр▓Хр▓Яр│Нр▓Яр│Ж р▓жр▓░р▓Чр▓│р▓┐р▓Чр│Ж <b>'Market Prices'</b> р▓кр▓░р▓┐р▓╢р│Ар▓▓р▓┐р▓╕р▓┐." }
        ]
    };

    let currentSlide = 0;
    let currentLang = 'en';
    const modal = document.getElementById('onboardingModal');

    function detectLanguage() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('lang')) return urlParams.get('lang');
        const match = document.cookie.match(/googtrans=\/en\/(\w+)/);
        if (match && match[1]) return match[1];
        return 'en';
    }

    window.addEventListener('load', () => {
        currentLang = detectLanguage();
        if (!allTranslations[currentLang]) currentLang = 'en';
        if (!localStorage.getItem('seenOnboarding_v4')) {
            setTimeout(() => { startOnboarding(); }, 1000); 
        }
    });

    function startOnboarding() { currentSlide = 0; updateSlide(); modal.style.display = 'flex'; }
    function nextSlide() { if (currentSlide < 2) { currentSlide++; updateSlide(); } else { closeOnboarding(); } }
    function closeOnboarding() { modal.style.display = 'none'; localStorage.setItem('seenOnboarding_v4', 'true'); }
    function updateSlide() {
        const data = allTranslations[currentLang][currentSlide];
        document.getElementById('obIcon').innerText = data.icon;
        document.getElementById('obTitle').innerText = data.title;
        document.getElementById('obDesc').innerHTML = data.desc;
        document.querySelectorAll('.dot').forEach((d, i) => d.classList.toggle('active', i === currentSlide));
        const btn = document.getElementById('obBtn');
        const finishText = { 'en': "Start Farming ЁЯЪА", 'hi': "рд╢реБрд░реВ рдХрд░реЗрдВ ЁЯЪА", 'ta': "родрпКроЯроЩрпНроХро╡рпБроорпН ЁЯЪА", 'te': "р░кр▒Нр░░р░╛р░░р░Вр░нр░┐р░Вр░Ър░Вр░бр░┐ ЁЯЪА", 'kn': "р▓кр│Нр▓░р▓╛р▓░р▓Вр▓нр▓┐р▓╕р▓┐ ЁЯЪА" };
        const nextText = { 'en': "Next", 'hi': "рдЕрдЧрд▓рд╛", 'ta': "роЕроЯрпБродрпНродрпБ", 'te': "р░др░░р▒Бр░╡р░╛р░д", 'kn': "р▓ор│Бр▓Вр▓жр│Ж" };
        btn.innerText = (currentSlide === 2) ? (finishText[currentLang] || finishText['en']) : (nextText[currentLang] || nextText['en']);
        btn.style.background = (currentSlide === 2) ? "#2c5e2e" : "#4CAF50";
    }
</script>
{% endblock %}