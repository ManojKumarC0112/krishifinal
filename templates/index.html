<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Krishi Sakhi</title>
  <link rel="stylesheet" href="{% static 'css/index.css' %}">
  <link rel="stylesheet" href="{% static 'css/global_styles.css' %}">
  
  <style>
    /* Copied from base.html to make navbar work */
    .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #2c5e2e;
        padding: 1rem 2rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        box-sizing: border-box;
    }
    .navbar .logo {
        font-size: 1.6rem;
        font-weight: bold;
        color: #fff;
        text-decoration: none;
    }
    .navbar .nav-links {
        display: flex;
        align-items: center;
    }
    .navbar .nav-links a {
        color: white;
        text-decoration: none;
        margin-left: 1.5rem;
        font-weight: 500;
        font-size: 1rem;
        padding: 8px 0;
        border-bottom: 2px solid transparent;
    }
    .navbar .nav-links a:hover,
    .navbar .nav-links a.active {
        color: #a7d3a6;
        border-bottom: 2px solid #a7d3a6;
    }
    .navbar .nav-auth {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    .navbar .nav-auth a.btn-auth-link {
        color: white;
        text-decoration: none;
        margin-left: 1.5rem;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border: 1px solid #a7d3a6;
        border-radius: 20px;
    }
    .navbar .nav-auth a.btn-auth-link:hover {
        background-color: #a7d3a6;
        color: #2c5e2e;
    }

    /* --- ‚úÖ MENU FIXES START --- */
    .profile-menu, .language-menu {
        position: relative;
        display: inline-block;
        vertical-align: middle; 
        cursor: pointer;
        color: white;
        padding: 10px 0; /* Larger hit area */
    }
    /* Invisible bridge to keep menu open */
    .profile-menu::after, .language-menu::after {
        content: '';
        position: absolute;
        left: 0;
        bottom: 0;
        width: 100%;
        height: 20px; 
        background: transparent;
    }
    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #fff;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1001;
        right: 0;
        top: 100%;
        margin-top: 0px; 
        border-radius: 8px;
        overflow: hidden;
    }
    .dropdown-content a {
        color: black !important;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        margin-left: 0 !important;
    }
    .dropdown-content a:hover {
        background-color: #f1f1f1;
    }
    .profile-menu:hover .dropdown-content,
    .language-menu:hover .dropdown-content {
        display: block;
    }
    /* Hide Google Toolbar */
    .goog-te-banner-frame.skiptranslate {
        display: none !important;
    } 
    body {
        top: 0px !important; 
    }
    #google_translate_element {
        display: none; 
    }
    /* --- ‚úÖ MENU FIXES END --- */

    @media (max-width: 768px) {
    .hero-text {
        padding: 1.5rem;
        margin: 0 1rem; 
    }
    .hero-text h1 {
        font-size: 2rem; 
    }
    .hero-text p {
        font-size: 1rem;
    }
    .about {
        padding: 2rem 1rem;
    }
}
  </style>
</head>
<body>

   <div id="google_translate_element"></div>

  <nav class="navbar">
      <a class="logo" href="{% url 'index' %}">
    <img src="{% static 'images/logo.png' %}" alt="Logo" style="height: 50px; vertical-align: middle; margin-right: 10px;">
    Krishi Sakhi
</a>

      <div class="nav-links">
          <a href="{% url 'index' %}" class="active">Home</a>
          <a href="{% url 'analyze_field_dashboard' %}">Analyze Field </a> 
          <a href="{% url 'crop_prices' %}">Market Prices</a>
          <a href="{% url 'schemes' %}" id="schemes-link">Schemes</a>
          <a href="{% url 'weather' %}">Weather</a>
          <a href="{% url 'chatbot' %}">Chat</a>
      </div>

      <div class="nav-auth">
          {% if user.is_authenticated %}
              
              <div class="language-menu">
                  <div class="lang-icon" style="font-size: 1.5rem;">üåê</div>
                  <div class="dropdown-content">
                      <a href="#" onclick="switchLanguage('en'); return false;">English</a>
                      <a href="#" onclick="switchLanguage('hi'); return false;">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</a>
                      <a href="#" onclick="switchLanguage('ta'); return false;">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</a>
                      <a href="#" onclick="switchLanguage('te'); return false;">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</a>
                      <a href="#" onclick="switchLanguage('kn'); return false;">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</a>
                  </div>
              </div>
              
              <div class="profile-menu">
                  <div class="profile-pic">
                      {{ user.username|first|upper|default:'K' }}
                  </div>
                  <div class="dropdown-content">
                      <div class="dropdown-header">
                          <strong>{{ user.first_name|default:user.username }}</strong>
                          <span>{{ user.email }}</span>
                      </div>
                      <a href="{% url 'profile' %}">View Profile</a>
                      <a href="{% url 'personalize' %}">My Farm</a>
                      <a href="{% url 'history' %}">Prediction History</a>
                      <a href="{% url 'logout' %}" class="logout-link">Logout</a>
                  </div>
              </div>

          {% else %}
              <a href="{% url 'login' %}" class="btn-auth-link">Login</a>
              <a href="{% url 'signup' %}" class="btn-auth-link">Sign Up</a>
          {% endif %}
      </div>
  </nav>

  <section class="hero">
    <div class="hero-text">
      
      {% if user.is_authenticated %}
        <h1 id="greeting">{{ timeGreeting }}, {{ user.username }}! üåæ</h1>
        <p>What would you like to do today?</p>
        <a href="{% url 'analyze_field_dashboard' %}" class="btn" id="actionBtn">Analyze Field</a>
        <a href="{% url 'crop_prices' %}" class="btn" style="margin-left: 1rem; background: #ffc107; color: #333;">Check Prices</a>
      {% else %}
        <h1 id="greeting">Welcome to Krishi Sakhi</h1>
        <p>Your smart farming assistant using AI üå±</p>
        <a href="{% url 'login' %}" class="btn" id="actionBtn">Login to Start</a>
      {% endif %}
      
    </div>
  </section>

  <footer>
    <p>¬© 2025 Krishi Sakhi |By MNV Nexus üåæ</p>
  </footer>

  <a href="{% url 'chatbot' %}" class="chat-widget-button" title="Chat with Sakhi">
      üí¨
  </a>

  <script type="text/javascript">
    function googleTranslateElementInit() {
        new google.translate.TranslateElement({
            pageLanguage: 'en',
            includedLanguages: 'en,hi,ta,te,kn',
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
            autoDisplay: false
        }, 'google_translate_element');
    }
  </script>
  <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <script>
      // ‚úÖ Aggressive Language Switcher Logic
      function switchLanguage(langCode) {
          var cookieVal = "/en/" + langCode;
          document.cookie = "googtrans=" + cookieVal + "; path=/";
          document.cookie = "googtrans=" + cookieVal + "; path=/; domain=" + window.location.hostname;
          document.cookie = "googtrans=" + cookieVal + "; path=/; domain=.127.0.0.1";
          document.cookie = "googtrans=" + cookieVal + "; path=/; domain=.localhost";
          
          const csrfToken = '{{ csrf_token }}'; 
          // If csrf_token tag not in body, fallback might be needed but usually Django injects it in session
          // For safety in index.html, we just assume it might work or we reload.
          
          fetch('{% url "personalize" %}', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/x-www-form-urlencoded',
                  'X-CSRFToken': '{{ csrf_token }}' // Ensure this renders or is available
              },
              body: `language=${langCode}`
          })
          .then(() => {
              var newUrl = new URL(window.location.href);
              newUrl.searchParams.set('lang', langCode);
              window.location.href = newUrl.toString();
          })
          .catch(() => {
              var newUrl = new URL(window.location.href);
              newUrl.searchParams.set('lang', langCode);
              window.location.href = newUrl.toString();
          });
      }

      const facts = [
          "India is the world's largest producer of milk, pulses, and jute.",
          "The monsoon is often called the 'true finance minister of India'.",
          "India's agriculture sector employs nearly half of the country's workforce.",
          "The staple crop Rice covers the largest area under cultivation in India.",
          "The Green Revolution in India started in the 1960s.",
          "India has 15 different agro-climatic zones.",
          "Black soil (Regur soil) is ideal for growing cotton and sugarcane."
      ];
      
       
      const factText = document.getElementById('preloader-fact');
      const loaderText = document.getElementById('preloader-text');

      if (factText) {
          factText.innerHTML = facts[Math.floor(Math.random() * facts.length)];
          let factInterval = setInterval(function() {
              factText.innerHTML = facts[Math.floor(Math.random() * facts.length)];
          }, 3000);
      }

      const schemesLink = document.getElementById('schemes-link');
      if (schemesLink) {
          schemesLink.addEventListener('click', function(e) {
              if (loaderText) loaderText.innerText = 'Fetching latest schemes suitable for you...';
              const preloader = document.getElementById('preloader'); // Define here locally if needed
              if (preloader) {
                  preloader.style.opacity = '1';
                  preloader.style.display = 'flex';
              }
          });
      }

      window.onload = () => {
          const preloader = document.getElementById('preloader'); // Define locally
          // clearInterval(factInterval); // Not accessible here if var let defined inside
          if (preloader) {
            preloader.style.opacity = '0';
            setTimeout(() => { preloader.style.display = 'none'; }, 500);
          }
      };
  </script>
  </body>
</html>