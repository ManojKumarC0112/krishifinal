<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Krishi Sakhi</title>
  <link rel="stylesheet" href="{% static 'css/index.css' %}">
  <link rel="stylesheet" href="{% static 'css/global_styles.css' %}">
  
  <style>
    /* Copied from base.html to make navbar work */
    .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #2c5e2e;
        padding: 1rem 2rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        position: fixed;
        width: 100%;
        z-index: 100;
    }
    .navbar .logo {
        font-size: 1.6rem;
        font-weight: bold;
        color: #fff;
        text-decoration: none;
    }
    .navbar .nav-links {
        display: flex;
        align-items: center;
    }
    .navbar .nav-links a {
        color: white;
        text-decoration: none;
        margin-left: 1.5rem;
        font-weight: 500;
        font-size: 1rem;
        padding: 8px 0;
        border-bottom: 2px solid transparent;
    }
    .navbar .nav-links a:hover,
    .navbar .nav-links a.active {
        color: #a7d3a6;
        border-bottom: 2px solid #a7d3a6;
    }
    .navbar .nav-auth {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    .navbar .nav-auth a.btn-auth-link {
        color: white;
        text-decoration: none;
        margin-left: 1.5rem;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border: 1px solid #a7d3a6;
        border-radius: 20px;
    }
    .navbar .nav-auth a.btn-auth-link:hover {
        background-color: #a7d3a6;
        color: #2c5e2e;
    }
  </style>
</head>
<body>

  <div id="preloader">
      <div id="preloader-spinner"></div>
      <p id="preloader-text">Loading... Please wait.</p>
      <p id="preloader-fact"></p>
  </div>
  <nav class="navbar">
      <a class="logo" href="{% url 'index' %}">
    <img src="{% static 'images/logo.png' %}" alt="Logo" style="height: 50px; vertical-align: middle; margin-right: 10px;">
    Krishi Sakhi
</a>

      <div class="nav-links">
          <a href="{% url 'index' %}" class="active">Home</a>
          <a href="{% url 'analyze_field_dashboard' %}">Analyze Field </a> 
          <a href="{% url 'crop_prices' %}">Market Prices</a>
          <a href="{% url 'schemes' %}" id="schemes-link">Schemes</a>
          <a href="{% url 'weather' %}">Weather</a>
          <a href="{% url 'chatbot' %}">Chat</a>
      </div>

      <div class="nav-auth">
          {% if user.is_authenticated %}
              
              <div class="language-menu">
                  <div class="lang-icon">üåê</div>
                  <div class="dropdown-content">
                      <a href="?lang=en">English</a>
                      <a href="?lang=hi">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</a>
                      <a href="?lang=ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</a>
                      <a href="?lang=te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</a>
                      <a href="?lang=kn">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</a>
                  </div>
              </div>
              
              <div class="profile-menu">
                  <div class="profile-pic">
                      {{ user.username|first|upper|default:'K' }}
                  </div>
                  <div class="dropdown-content">
                      <div class="dropdown-header">
                          <strong>{{ user.first_name|default:user.username }}</strong>
                          <span>{{ user.email }}</span>
                      </div>
                      <a href="{% url 'profile' %}">View Profile</a>
                      <a href="{% url 'personalize' %}">My Farm</a>
                      <a href="{% url 'history' %}">Prediction History</a>
                      <a href="{% url 'logout' %}" class="logout-link">Logout</a>
                  </div>
              </div>

          {% else %}
              <a href="{% url 'login' %}" class="btn-auth-link">Login</a>
              <a href="{% url 'signup' %}" class="btn-auth-link">Sign Up</a>
          {% endif %}
      </div>
  </nav>

  <section class="hero">
    <div class="hero-text">
      
      {% if user.is_authenticated %}
        <h1 id="greeting">{{ timeGreeting }}, {{ user.username }}! üåæ</h1>
        <p>What would you like to do today?</p>
        <a href="{% url 'analyze_field_dashboard' %}" class="btn" id="actionBtn">Analyze Field</a>
        <a href="{% url 'crop_prices' %}" class="btn" style="margin-left: 1rem; background: #ffc107; color: #333;">Check Prices</a>
      {% else %}
        <h1 id="greeting">Welcome to Krishi Sakhi</h1>
        <p>Your smart farming assistant using AI üå±</p>
        <a href="{% url 'login' %}" class="btn" id="actionBtn">Login to Start</a>
      {% endif %}
      
    </div>
  </section>

  <footer>
    <p>¬© 2025 Krishi Sakhi |By MNV Nexus üåæ</p>
  </footer>

  <a href="{% url 'chatbot' %}" class="chat-widget-button" title="Chat with Sakhi">
      üí¨
  </a>
  <script>
      const facts = [
          "India is the world's largest producer of milk, pulses, and jute.",
          "The monsoon is often called the 'true finance minister of India'.",
          "India's agriculture sector employs nearly half of the country's workforce.",
          "The staple crop Rice covers the largest area under cultivation in India.",
          "The Green Revolution in India started in the 1960s.",
          "India has 15 different agro-climatic zones.",
          "Black soil (Regur soil) is ideal for growing cotton and sugarcane."
      ];
      
      const preloader = document.getElementById('preloader');
      const factText = document.getElementById('preloader-fact');
      const loaderText = document.getElementById('preloader-text');

      // 1. Show a fact immediately
      factText.innerHTML = facts[Math.floor(Math.random() * facts.length)];
      
      // 2. Change the fact every 3 seconds
      let factInterval = setInterval(function() {
          factText.innerHTML = facts[Math.floor(Math.random() * facts.length)];
      }, 3000);

      // --- NEW: On-click loader for slow pages ---
      const schemesLink = document.getElementById('schemes-link');
      if (schemesLink) {
          schemesLink.addEventListener('click', function(e) {
              // Set the custom text you wanted
              loaderText.innerText = 'Fetching latest schemes suitable for you...';
              
              // Force the preloader to show *now*
              preloader.style.opacity = '1';
              preloader.style.display = 'flex';
          });
      }

      // 4. When the page is fully loaded, fade out the preloader
      window.onload = () => {
          clearInterval(factInterval); // Stop changing facts
          preloader.style.opacity = '0'; // Start fade out
          
          // Wait for animation to finish, then hide it
          setTimeout(() => {
              preloader.style.display = 'none';
          }, 500); // 500ms = 0.5s (matches CSS transition)
      };
  </script>
  </body>
</html>