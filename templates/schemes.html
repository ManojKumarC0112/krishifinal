<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Government Schemes - Krishi Sakhi</title>
  <link rel="stylesheet" href="{% static 'css/schemes.css' %}">
  <link rel="stylesheet" href="{% static 'css/global_styles.css' %}">
  
  <style>
    /* Copied from base.html to make navbar work */
    .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #2c5e2e;
        padding: 1rem 2rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
    }
    .navbar .logo {
        font-size: 1.6rem;
        font-weight: bold;
        color: #fff;
        text-decoration: none;
    }
    .navbar .nav-links {
        display: flex;
        align-items: center;
    }
    .navbar .nav-links a {
        color: white;
        text-decoration: none;
        margin-left: 1.5rem;
        font-weight: 500;
        font-size: 1rem;
        padding: 8px 0;
        border-bottom: 2px solid transparent;
    }
    .navbar .nav-links a:hover,
    .navbar .nav-links a.active {
        color: #a7d3a6;
        border-bottom: 2px solid #a7d3a6;
    }
    .navbar .nav-auth {
        display: flex;
        align-items: center;
        gap: 1rem; /* NEW */
    }
    .navbar .nav-auth a.btn-auth-link {
        color: white;
        text-decoration: none;
        margin-left: 1.5rem;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border: 1px solid #a7d3a6;
        border-radius: 20px;
    }
    .navbar .nav-auth a.btn-auth-link:hover {
        background-color: #a7d3a6;
        color: #2c5e2e;
    }
  
    /* --- NEW: Schemes Page Styles --- */
    .scheme-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); /* Larger cards */
      gap: 1.5rem;
      padding: 1rem;
    }
    .scheme-card {
      display: block; /* Overrides from global_styles */
      text-decoration: none; /* Overrides from global_styles */
      color: #333; /* Overrides from global_styles */
      
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
      overflow: hidden; /* To contain header */
    }
    .scheme-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.1);
    }
    
    /* Card Header with Icon and Category */
    .scheme-card-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.25rem 1.5rem;
      background: #f1f8e9;
      border-bottom: 1px solid #e0e0e0;
    }
    .scheme-card-icon {
      font-size: 1.8rem;
    }
    .scheme-card-header-text {
      flex: 1;
    }
    .scheme-tag {
      display: inline-block;
      font-size: 0.8rem;
      font-weight: bold;
      padding: 4px 10px;
      border-radius: 15px;
      color: #2c5e2e;
      background-color: #dcedc8;
    }
    
    /* Card Content */
    .scheme-card-content {
      padding: 1.5rem;
    }
    .scheme-card-content h3 {
      color: #2c5e2e;
      margin-top: 0;
      margin-bottom: 0.75rem;
    }
    .scheme-card-content p {
      font-size: 0.95rem;
      line-height: 1.6;
      color: #333;
    }
    .scheme-card-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid #f0f0f0;
      text-align: right;
    }
    .scheme-card-footer p {
      font-weight: bold;
      color: #4CAF50;
      margin: 0;
    }
    
  </style>
  
</head>
<body>

  <div id="preloader">
      <div id="preloader-spinner"></div>
      <p id="preloader-text">Loading... Please wait.</p>
      <p id="preloader-fact"></p>
  </div>
  <nav class="navbar">
      <a class="logo" href="{% url 'index' %}">
    <img src="{% static 'images/logo.png' %}" alt="Logo" style="height: 50px; vertical-align: middle; margin-right: 10px;">
    Krishi Sakhi
</a>

      <div class="nav-links">
          <a href="{% url 'index' %}">Home</a>
          <a href="{% url 'analyze_field_dashboard' %}">Analyze Field </a> 

          <a href="{% url 'live_vision' %}">Live Vision</a>
          <a href="{% url 'crop_prices' %}" id="prices-link">Market Prices</a>
          <a href="{% url 'schemes' %}" id="schemes-link" class="active">Schemes</a>
          <a href="{% url 'weather' %}">Weather</a>
          <a href="{% url 'chatbot' %}">Chat</a>
      </div>

      <div class="nav-auth">
          {% if user.is_authenticated %}
              
              <div class="language-menu">
                  <div class="lang-icon">üåê</div>
                  <div class="dropdown-content">
                      <a href="?lang=en">English</a>
                      <a href="?lang=hi">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</a>
                      <a href="?lang=ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</a>
                      <a href="?lang=te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</a>
                      <a href="?lang=kn">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</a>
                  </div>
              </div>
              
              <div class="profile-menu">
                  <div class="profile-pic">
                      {{ user.username|first|upper|default:'K' }}
                  </div>
                  <div class="dropdown-content">
                      <div class="dropdown-header">
                          <strong>{{ user.first_name|default:user.username }}</strong>
                          <span>{{ user.email }}</span>
                      </div>
                      <a href="{% url 'profile' %}">View Profile</a>
                      <a href="{% url 'personalize' %}">My Farm</a>
                      <a href="{% url 'history' %}">Prediction History</a>
                      <a href="{% url 'logout' %}" class="logout-link">Logout</a>
                  </div>
              </div>

          {% else %}
              <a href="{% url 'login' %}" class="btn-auth-link">Login</a>
              <a href="{% url 'signup' %}" class="btn-auth-link">Sign Up</a>
          {% endif %}
      </div>
  </nav>

  <section class="schemes">
    <h1>Government Schemes for Farmers üåæ</h1>
    <p>Live schemes fetched and categorized by Sakhi AI.</p>
    
    <div class="scheme-container" id="schemeContainer">
      
      {% if error %}
        <p class="no-schemes" style="color: red;">{{ error }}</p>
      
      {% else %}
        
        {% for scheme in schemes %}
          <a class="scheme-card" href="{{ scheme.url }}" target="_blank" rel="noopener noreferrer">
              
              <div class="scheme-card-header">
                  
                  {% if 'KISAN' in scheme.name or 'Finance' in scheme.name %}
                      <div class="scheme-card-icon">üí∞</div>
                      <div class="scheme-card-header-text">
                          <span class="scheme-tag">Financial Aid</span>
                      </div>
                  {% elif 'PMFBY' in scheme.name or 'Insurance' in scheme.name %}
                      <div class="scheme-card-icon">‚òÇÔ∏è</div>
                      <div class="scheme-card-header-text">
                          <span class="scheme-tag">Crop Insurance</span>
                      </div>
                  {% elif 'eNAM' in scheme.name or 'Market' in scheme.name %}
                      <div class="scheme-card-icon">üìà</div>
                      <div class="scheme-card-header-text">
                          <span class="scheme-tag">Market Linkage</span>
                      </div>
                  {% else %}
                      <div class="scheme-card-icon">üìÑ</div>
                      <div class="scheme-card-header-text">
                          <span class="scheme-tag">General Scheme</span>
                      </div>
                  {% endif %}
              </div>
              
              <div class="scheme-card-content">
                  <h3>{{ scheme.name }}</h3>
                  <p>{{ scheme.description }}</p>
              </div>
              
              <div class="scheme-card-footer">
                  <p>Visit Official Site ‚Üí</p>
              </div>
          </a>
        {% empty %}
          <p class="no-schemes">No schemes are currently available. Please check back later.</p>
        {% endfor %}
        
      {% endif %}
      
    </div>
  </section>

  <footer>
    <p>¬© 2025 Krishi Sakhi | Smart Farming Assistant</p>
  </footer>

  <a href="{% url 'chatbot' %}" class="chat-widget-button" title="Chat with Sakhi">
      üí¨
  </a>

  <script>
      const facts = [
          "India is the world's largest producer of milk, pulses, and jute.",
          "The monsoon is often called the 'true finance minister of India'.",
          "India's agriculture sector employs nearly half of the country's workforce.",
          "The staple crop Rice covers the largest area under cultivation in India.",
          "The Green Revolution in India started in the 1960s.",
          "India has 15 different agro-climatic zones.",
          "Black soil (Regur soil) is ideal for growing cotton and sugarcane."
      ];
      
      const preloader = document.getElementById('preloader');
      const factText = document.getElementById('preloader-fact');
      const loaderText = document.getElementById('preloader-text');

      // 1. Show a fact immediately
      if (factText) {
          factText.innerHTML = facts[Math.floor(Math.random() * facts.length)];
      }
      
      // 2. Change the fact every 3 seconds
      let factInterval = setInterval(function() {
          if (factText) {
              factText.innerHTML = facts[Math.floor(Math.random() * facts.length)];
          }
      }, 3000);

      // --- NEW: On-click loader for slow pages ---
      function attachLoader(linkId, text) {
          const link = document.getElementById(linkId);
          if (link) {
              link.addEventListener('click', function(e) {
                  if (loaderText) {
                      loaderText.innerText = text;
                  }
                  if (preloader) {
                      preloader.style.opacity = '1';
                      preloader.style.display = 'flex';
                  }
              });
          }
      }
      
      // Attach loaders to both links
      attachLoader('schemes-link', 'Fetching latest schemes suitable for you...');
      attachLoader('prices-link', 'Fetching live market prices...');

      // 4. When the page is fully loaded, fade out the preloader
      window.onload = () => {
          clearInterval(factInterval); // Stop changing facts
          if (preloader) {
              preloader.style.opacity = '0'; // Start fade out
              
              setTimeout(() => {
                  preloader.style.display = 'none';
              }, 500); // 500ms = 0.5s (matches CSS transition)
          }
      };
  </script>

</body>
</html>